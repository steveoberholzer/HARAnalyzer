<Window x:Class="HARAnalyzer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="HAR Analyzer"
        Height="720" Width="1280"
        MinHeight="480" MinWidth="720"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded">

    <Window.InputBindings>
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
    </Window.InputBindings>

    <DockPanel>

        <!-- Menu bar -->
        <Menu DockPanel.Dock="Top" FontSize="13">
            <MenuItem x:Name="FileMenu" Header="_File">
                <MenuItem x:Name="MenuOpen" Header="_Open…" InputGestureText="Ctrl+O" Click="MenuOpen_Click"/>
                <MenuItem x:Name="MenuCompare" Header="Compare Two Files…" Click="MenuCompare_Click"/>
                <MenuItem x:Name="MenuTrim"    Header="Trim HAR…"            Click="MenuTrim_Click" IsEnabled="False"/>
                <Separator/>
                <!-- MRU items injected here at runtime; hidden when list is empty -->
                <Separator x:Name="SepMru" Visibility="Collapsed"/>
                <MenuItem x:Name="MenuClearMru" Header="Clear Recent Files" Visibility="Collapsed" Click="MenuClearMru_Click"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="MenuExit_Click"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Expand All"   Click="MenuExpandAll_Click"/>
                <MenuItem Header="Collapse All" Click="MenuCollapseAll_Click"/>
                <Separator/>
                <MenuItem Header="Reload File"  x:Name="MenuReload" IsEnabled="False" Click="MenuReload_Click"/>
            </MenuItem>
        </Menu>

        <!-- Status bar -->
        <StatusBar DockPanel.Dock="Bottom" Height="24" FontSize="12">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="Ready — open a .HAR file to begin (Ctrl+O)"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <ProgressBar x:Name="LoadProgress"
                             Width="120" Height="12"
                             IsIndeterminate="True"
                             Visibility="Collapsed"/>
            </StatusBarItem>
        </StatusBar>

        <!-- Main split view -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="280" MinWidth="140" MaxWidth="700"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"   MinWidth="300"/>
            </Grid.ColumnDefinitions>

            <!-- Left: TreeView -->
            <TreeView x:Name="MainTree"
                      Grid.Column="0"
                      BorderThickness="0,0,1,0"
                      BorderBrush="#d0d0d0"
                      FontSize="13"
                      Background="#fafafa"
                      SelectedItemChanged="MainTree_SelectedItemChanged"
                      AllowDrop="True"
                      Drop="MainTree_Drop"
                      DragOver="MainTree_DragOver"
                      PreviewMouseRightButtonDown="MainTree_PreviewMouseRightButtonDown">
                <TreeView.ContextMenu>
                    <ContextMenu Opened="TreeContextMenu_Opened">
                        <MenuItem Header="Export to CSV…"  Click="CtxExportCsv_Click"/>
                        <MenuItem Header="Copy as CSV"     Click="CtxCopyCsv_Click"/>
                    </ContextMenu>
                </TreeView.ContextMenu>
            </TreeView>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1"
                          HorizontalAlignment="Stretch"
                          Background="#d8d8d8"
                          ShowsPreview="True"/>

            <!-- Right: WebView2 -->
            <wv2:WebView2 x:Name="ContentBrowser"
                          Grid.Column="2"/>
        </Grid>

    </DockPanel>
</Window>
